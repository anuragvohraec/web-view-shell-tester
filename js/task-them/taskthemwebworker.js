(()=>{"use strict";const e=new Set(["COMPLETED","FAILED"]);var t,a;!function(e){e.INIT_WEBWORKER="INIT_WEBWORKER",e.CHANGE_TASK_STATE="CHANGE_TASK_STATE",e.CHANGE_TASK_PHASE="CHANGE_TASK_PHASE",e.CREATE_TASK="CREATE_TASK",e.RUN_A_TASK="RUN_A_TASK",e.GET_TASK_STATUS="GET_TASK_STATUS",e.CLEAR_TASK_THEM="CLEAR_TASK_THEM"}(t||(t={})),function(e){e.RUN_TASK="RUN_TASK",e.TASK_STATUS="TASK_STATUS",e.CLEAR_TASK_THEM="CLEAR_TASK_THEM",e.PHASE_CHANGE="PHASE_CHANGE"}(a||(a={}));const s="_task_them_entries",r=new class{constructor(e,t,a){this.databaseName=e,indexedDB&&(this.req=indexedDB.open(e,t),this.req.onupgradeneeded=e=>{this.db=this.req.result,a.forEach((e=>{this.createObjectStore(e)}))},this.isInitialized=new Promise(((e,t)=>{this.req.onsuccess=t=>{this.db=this.req.result,e(!0)}})))}closeTheDB(){this.db.close()}static async checkIfDBExist(e){return(await indexedDB.databases()).map((e=>e.name)).includes(e)}async getCountInStore(e){try{const t=this.db.transaction([e]).objectStore(e).count();return await new Promise((e=>{t.onsuccess=()=>{e(t.result)}}))}catch(e){return console.error(e),-1}}async getLastObjectFromObjectStore(e){try{const t=this.db.transaction([e]).objectStore(e).openCursor(null,"prev");return(await new Promise(((e,a)=>{t.onsuccess=t=>{e(t.target.result)},t.onerror=a})))?.value}catch(e){return void console.error(e)}}async deleteTheDB(){if(await this.isInitialized)try{this.closeTheDB();const e=indexedDB.deleteDatabase(this.databaseName);return"success"===(await(async()=>new Promise(((t,a)=>{e.onsuccess=t,e.onerror=a})))()).type}catch(e){return console.error("Failed to delete the database"),console.error(e),!1}}createObjectStore(e){if(!this.db.objectStoreNames.contains(e.name)){let t;if(t=e.primaryKeyName?this.db.createObjectStore(e.name,{keyPath:e.primaryKeyName}):this.db.createObjectStore(e.name,{autoIncrement:!0}),e.indexes)for(let a of e.indexes)t.createIndex(a,a)}}async cleanAllObjectStores(){let e=!1;if(await this.isInitialized){const t=this.db.objectStoreNames.length;try{for(let e=0;e<t;e++){const t=this.db.objectStoreNames.item(e),a=this.db.transaction([t],"readwrite").objectStore(t).clear();if(!await new Promise((e=>{a.onsuccess=t=>{e(!0)},a.onerror=t=>{e(!1)}})))throw`${t} not cleared`}e=!0}catch(e){console.error(e)}}return e}async create(e,t){if(await this.isInitialized)try{const a=this.db.transaction([e],"readwrite").objectStore(e).add(t);return await new Promise(((e,t)=>{a.onsuccess=()=>{e(!0)},a.onerror=()=>{e(!1)}}))}catch(e){return console.error("Failed to create"),console.error(e),!1}}async updateItemWithKey(e,t,a){const s=this.db.transaction([e],"readwrite").objectStore(e);return s?await new Promise(((e,a)=>{s.getKey(t).onsuccess=t=>{let a=s.result;e(!!a)}}))?await new Promise(((e,r)=>{const n=s.put(a,t);n.onsuccess=t=>{e(!0)},n.onerror=a=>{console.error(`Failed to save attachment ${this.databaseName}/${t}`),console.error(a),e(!1)}})):await new Promise(((e,r)=>{const n=s.add(a,t);n.onsuccess=t=>{e(!0)},n.onerror=a=>{console.error(`Failed to save attachment ${this.databaseName}/${t}`),console.error(a),e(!1)}})):(console.log("No such DB: ",e),!1)}async read(e,t){if(await this.isInitialized)return await this._read(e,t)}async _read(e,t){try{const a=this.db.transaction([e]).objectStore(e);if(t){const e=a.get(t);return await new Promise((t=>{e.onsuccess=e=>{t(e.target.result)},e.onerror=e=>{t(void 0)}}))}return await new Promise((e=>{let t=a.getAll();t.onsuccess=t=>{e(t.target.result)},t.onerror=t=>{e(void 0)}}))}catch(e){console.error(e)}}async _update(e,t){if(await this.isInitialized)try{const a=this.db.transaction([e],"readwrite").objectStore(e).put(t);return await new Promise((e=>{a.onsuccess=t=>{e(!0)},a.onerror=t=>{e(!1)}}))}catch(e){return console.error("Failed to update"),console.error(e),!1}}async update(e,t,a,s){const r=await this.read(e,t);if(r){const t=await a(r);return!!t&&await this._update(e,t)}return!!s&&await this.create(e,s)}async delete(e,t){if(await this.isInitialized){const a=this.db.transaction([e],"readwrite").objectStore(e).delete(t);return await new Promise((e=>{a.onsuccess=t=>{e(!0)},a.onerror=t=>{e(!1)}}))}}async find(e,t,a){const s=[];if(await this.isInitialized){const r=this.db.transaction([e],"readonly").objectStore(e).index(t);if(r){const e=IDBKeyRange.only(a);await new Promise((t=>{r.openCursor(e).onsuccess=e=>{const a=e.target.result;a?(s.push(a.value),a.continue()):t()}}))}}return s}}("TASK_THEM_DB",1,[{name:s,primaryKeyName:"_id",indexes:["task_name","ended","created_date","updated_date"]}]),n=new ReadableStream({start:e=>{onmessage=t=>{e.enqueue(t)}}});class o{static async init(e){const t=await r.find(s,"ended","false");if(t.length>0){t.sort(((e,t)=>e.created_date-t.created_date));for(let e of t)postMessage({type:a.RUN_TASK,data:e})}if(e>-1){const t=await r.find(s,"ended","true");if(t.length>0){t.sort(((e,t)=>e.created_date-t.created_date));for(let a of t)a.created_date<=e&&await r.delete(s,a._id)}}}}o.process=async()=>{for await(let i of async function*(){const e=n.getReader();try{for(;;){const{done:t,value:a}=await e.read();if(t){console.warn("This should not end and should keep running!");break}yield a}}finally{e.releaseLock()}}())if(i){const n=i.data.data,c=i.data.type;switch(c){case t.CLEAR_TASK_THEM:await r.cleanAllObjectStores()?postMessage({type:a.CLEAR_TASK_THEM,data:!0}):postMessage({type:a.CLEAR_TASK_THEM,data:!1});break;case t.GET_TASK_STATUS:{const e=n.task_id;let t=await r.read(s,e);postMessage({type:a.TASK_STATUS,data:t})}break;case t.INIT_WEBWORKER:let d=i.data.archive_ended_task_before;await o.init(d);break;case t.CHANGE_TASK_STATE:{const t=n.task_id,a=n.state;await r.update(s,t,(t=>{e.has(a)&&(t.ended="true");const s=(new Date).getTime();if(t.updated_date=s,t.updates_logs[s]=`STATE CHANGED: ${a} , from: <${t.state}>`,"INIT"===a){const e=t.phase;t.phase=t.init_phase,t.phase_data=t.init_phase_data,t.updates_logs[s+1]=`PHASE CHANGED: ${t.init_phase} , from: <${e}>`}return t.state=a,t}))}break;case t.CHANGE_TASK_PHASE:{const e=n.task_id,t=n.phase,o=n.phase_data;await r.update(s,e,(e=>{const s=(new Date).getTime();e.updated_date=s,e.updates_logs[s]=`PHASE CHANGED: ${t} , from: <${e.phase}>`,e.state="CONTINUE",e.phase=t,e.phase_data=o;const r={task_name:e.task_name,new_phase:t,new_phase_data:o};return postMessage({type:a.PHASE_CHANGE,data:r}),e}))}break;case t.CREATE_TASK:{const e=n.task_name,t=n.behaves;if("ONLY_ONCE_IN_LIFE"===t){if((await r.find(s,"task_name",e)).length>0)break}else if("ONLY_ONE_ACTIVE_IN_QUEUE"===t){const t=await r.find(s,"ended","false");if(t.length>0&&t.filter((t=>t.name===e)).length>0)break}const o=n.task_desc,i=n.init_phase,c=n.init_phase_data,d=(new Date).getTime(),_={};_[d]="STATE CHANGED: INIT",_[d+1]=`PHASE CHANGED: ${i}`;const l=n._id,h={task_name:e,task_desc:o,init_phase:i,init_phase_data:c,behaves:t,_id:l,created_date:d,phase:i,phase_data:c,state:"INIT",ended:"false",updated_date:d,updates_logs:_};await r.create(s,h)&&postMessage({type:a.RUN_TASK,data:h})}break;case t.RUN_A_TASK:{const{task_id:e}=n,t=await r.read(s,e);t&&"true"!==t.ended&&postMessage({type:a.RUN_TASK,data:t})}break;default:throw`No such case: ${c} registered with scheduler!`}}},o.process()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly90YXNrLXRoZW0vLi9zcmMvbGliL2ludGVyZmFjZXMudHMiLCJ3ZWJwYWNrOi8vdGFzay10aGVtLy4vc3JjL2xpYi9jb25zdGFudHMudHMiLCJ3ZWJwYWNrOi8vdGFzay10aGVtLy4vc3JjL3dlYi13b3JrZXJzL3Rhc2stc2NoZWR1bGVyLXd3LnRzIiwid2VicGFjazovL3Rhc2stdGhlbS8uL3NyYy9saWIvZGFvLnRzIl0sIm5hbWVzIjpbIkVORElOR19TVEFURVMiLCJTZXQiLCJUYXNrTWFuYWdlck1lc3NhZ2UiLCJUYXNrU2NoZWR1bGVyTWVzc2FnZSIsInRhc2tfdGhlbV9vcyIsImRhbyIsImRhdGFiYXNlTmFtZSIsInZlcnNpb24iLCJsaXN0b2ZEQkRldGFpbHMiLCJpbmRleGVkREIiLCJ0aGlzIiwicmVxIiwib3BlbiIsIm9udXBncmFkZW5lZWRlZCIsImUiLCJkYiIsInJlc3VsdCIsImZvckVhY2giLCJlbGVtZW50IiwiY3JlYXRlT2JqZWN0U3RvcmUiLCJpc0luaXRpYWxpemVkIiwiUHJvbWlzZSIsInJlcyIsInJlaiIsIm9uc3VjY2VzcyIsImNsb3NlIiwiZGJuYW1lIiwiZGF0YWJhc2VzIiwibWFwIiwibmFtZSIsImluY2x1ZGVzIiwic3RvcmVOYW1lIiwicmVzcCIsInRyYW5zYWN0aW9uIiwib2JqZWN0U3RvcmUiLCJjb3VudCIsImNvbnNvbGUiLCJlcnJvciIsImNyIiwib3BlbkN1cnNvciIsImV2IiwidGFyZ2V0Iiwib25lcnJvciIsInZhbHVlIiwiY2xvc2VUaGVEQiIsImRlbGV0ZURhdGFiYXNlIiwidHlwZSIsImRiZGV0YWlsIiwib2JqZWN0U3RvcmVOYW1lcyIsImNvbnRhaW5zIiwib3MiLCJwcmltYXJ5S2V5TmFtZSIsImtleVBhdGgiLCJhdXRvSW5jcmVtZW50IiwiaW5kZXhlcyIsImkiLCJjcmVhdGVJbmRleCIsImFsbEdvb2QiLCJsIiwibGVuZ3RoIiwib3NOYW1lIiwiaXRlbSIsImNsZWFyIiwib2JqZWN0VG9TYXZlIiwiYWRkIiwia2V5IiwiZG9jIiwiZ2V0S2V5IiwicHV0IiwibG9nIiwiaW5kZXhWYWx1ZSIsIl9yZWFkIiwiZ2V0IiwidW5kZWZpbmVkIiwidCIsImdldEFsbCIsIm5ld1VwZGF0ZWRPYmplY3QiLCJwcmltYXJ5S2V5IiwidXBkYXRlT2JqZWN0RnVuY3Rpb24iLCJkb2NUb0NyZWF0ZSIsInJlYWQiLCJfdXBkYXRlIiwiY3JlYXRlIiwiZGVsZXRlIiwiaW5kZXhfbmFtZSIsImluZGV4IiwicmFuZ2UiLCJJREJLZXlSYW5nZSIsIm9ubHkiLCJjdXJzb3IiLCJwdXNoIiwiY29udGludWUiLCJtc2dFdmVudFN0cmVhbSIsIlJlYWRhYmxlU3RyZWFtIiwic3RhcnQiLCJjb250cm9sbGVyIiwib25tZXNzYWdlIiwiZW5xdWV1ZSIsIlRhc2tTY2hlZHVsZXIiLCJhcmNoaXZlX2VuZGVkX3Rhc2tfYmVmb3JlIiwiZm91bmRfbmV0IiwiZmluZCIsInNvcnQiLCJhIiwiYiIsImNyZWF0ZWRfZGF0ZSIsInRlIiwicG9zdE1lc3NhZ2UiLCJSVU5fVEFTSyIsImRhdGEiLCJmb3VuZF9ldCIsImV0IiwiX2lkIiwicHJvY2VzcyIsImFzeW5jIiwicmVhZGVyIiwiZ2V0UmVhZGVyIiwiZG9uZSIsIndhcm4iLCJyZWxlYXNlTG9jayIsIm1lc3NhZ2VFdmVudEdlbmVyYXRvciIsIm1zZ1R5cGUiLCJDTEVBUl9UQVNLX1RIRU0iLCJjbGVhbkFsbE9iamVjdFN0b3JlcyIsIkdFVF9UQVNLX1NUQVRVUyIsInRhc2tfaWQiLCJUQVNLX1NUQVRVUyIsIklOSVRfV0VCV09SS0VSIiwiaW5pdCIsIkNIQU5HRV9UQVNLX1NUQVRFIiwibmV3X3N0YXRlIiwic3RhdGUiLCJ1cGRhdGUiLCJvbGRPYmplY3QiLCJoYXMiLCJlbmRlZCIsIm5vdyIsIkRhdGUiLCJnZXRUaW1lIiwidXBkYXRlZF9kYXRlIiwidXBkYXRlc19sb2dzIiwib2xkX3BoYXNlIiwicGhhc2UiLCJpbml0X3BoYXNlIiwicGhhc2VfZGF0YSIsImluaXRfcGhhc2VfZGF0YSIsIkNIQU5HRV9UQVNLX1BIQVNFIiwibmV3X3BoYXNlIiwibmV3X3BoYXNlX2RhdGEiLCJwaGFzZUNoYW5nZURhdGEiLCJ0YXNrX25hbWUiLCJQSEFTRV9DSEFOR0UiLCJDUkVBVEVfVEFTSyIsImJlaGF2ZXMiLCJmb3VuZF9lbnRyaWVzIiwiZmlsdGVyIiwidGFza19kZXNjIiwiUlVOX0FfVEFTSyJdLCJtYXBwaW5ncyI6Im1CQWNPLE1BQU1BLEVBQThCLElBQUlDLElBQWdCLENBQUMsWUFBWSxXQ1o1RSxJQUFZQyxFQWVBQyxHQWZaLFNBQVlELEdBQ1Isa0NBQ0Esd0NBQ0Esd0NBQ0EsNEJBQ0EsMEJBQ0Esb0NBSUEsb0NBVkosQ0FBWUEsTUFBa0IsS0FlOUIsU0FBWUMsR0FDUixzQkFDQSw0QkFDQSxvQ0FDQSw4QkFKSixDQUFZQSxNQUFvQixLQU96QixNQUNNQyxFQUFlLHFCQ3RCdEJDLEVBQVUsSUNlVCxNQUtILFlBQW9CQyxFQUFxQkMsRUFBaUJDLEdBQXRDLEtBQUFGLGVBQ1pHLFlBQ0FDLEtBQUtDLElBQU1GLFVBQVVHLEtBQUtOLEVBQWNDLEdBRXhDRyxLQUFLQyxJQUFJRSxnQkFBbUJDLElBQ3hCSixLQUFLSyxHQUFLTCxLQUFLQyxJQUFJSyxPQUNuQlIsRUFBZ0JTLFNBQVFDLElBQ3BCUixLQUFLUyxrQkFBa0JELE9BSS9CUixLQUFLVSxjQUFnQixJQUFJQyxTQUFpQixDQUFDQyxFQUFLQyxLQUM1Q2IsS0FBS0MsSUFBSWEsVUFBYVYsSUFDbEJKLEtBQUtLLEdBQUtMLEtBQUtDLElBQUlLLE9BQ25CTSxHQUFJLFFBTWIsYUFDSFosS0FBS0ssR0FBR1UsUUFHTCw0QkFBNEJDLEdBRS9CLGFBQWNqQixVQUFVa0IsYUFBYUMsS0FBSWQsR0FBS0EsRUFBRWUsT0FBTUMsU0FBU0osR0FPNUQsc0JBQXNCSyxHQUN6QixJQUNJLE1BRU1DLEVBRkt0QixLQUFLSyxHQUFHa0IsWUFBWSxDQUFDRixJQUNsQkcsWUFBWUgsR0FDVkksUUFDaEIsYUFBYSxJQUFJZCxTQUFpQkMsSUFDOUJVLEVBQUtSLFVBQVUsS0FDWEYsRUFBSVUsRUFBS2hCLFlBR25CLE1BQU9GLEdBRUwsT0FEQXNCLFFBQVFDLE1BQU12QixJQUNOLEdBSVQsbUNBQW1DaUIsR0FDdEMsSUFDSSxNQUdNTyxFQUhLNUIsS0FBS0ssR0FBR2tCLFlBQVksQ0FBQ0YsSUFDbEJHLFlBQVlILEdBRVpRLFdBQVcsS0FBTSxRQVEvQixhQVBxQixJQUFJbEIsU0FBNEIsQ0FBQ0MsRUFBS0MsS0FDdkRlLEVBQUdkLFVBQWFnQixJQUVabEIsRUFBSWtCLEVBQUdDLE9BQU96QixTQUVsQnNCLEVBQUdJLFFBQVVuQixPQUVGb0IsTUFDakIsTUFBTzdCLEdBRUwsWUFEQXNCLFFBQVFDLE1BQU12QixJQUtmLG9CQUNILFNBQVVKLEtBQUtVLGNBQ1gsSUFDSVYsS0FBS2tDLGFBQ0wsTUFBTWpDLEVBQU1GLFVBQVVvQyxlQUFlbkMsS0FBS0osY0FPMUMsTUFBc0Isa0JBTkYsVUFDVCxJQUFJZSxTQUEwQixDQUFDQyxFQUFLQyxLQUN2Q1osRUFBSWEsVUFBWUYsRUFDaEJYLEVBQUkrQixRQUFVbkIsS0FIRixJQU1QdUIsS0FDZixNQUFPaEMsR0FHTCxPQUZBc0IsUUFBUUMsTUFBTSxpQ0FDZEQsUUFBUUMsTUFBTXZCLElBQ1AsR0FLbkIsa0JBQWtCaUMsR0FDZCxJQUFLckMsS0FBS0ssR0FBR2lDLGlCQUFpQkMsU0FBU0YsRUFBU2xCLE1BQU8sQ0FDbkQsSUFBSXFCLEVBTUosR0FKSUEsRUFEQUgsRUFBU0ksZUFDSnpDLEtBQUtLLEdBQUdJLGtCQUFrQjRCLEVBQVNsQixLQUFNLENBQUV1QixRQUFTTCxFQUFTSSxpQkFFN0R6QyxLQUFLSyxHQUFHSSxrQkFBa0I0QixFQUFTbEIsS0FBTSxDQUFFd0IsZUFBZSxJQUVoRU4sRUFBU08sUUFDUixJQUFJLElBQUlDLEtBQUtSLEVBQVNPLFFBQ2xCSixFQUFHTSxZQUFZRCxFQUFFQSxJQU1qQyw2QkFDSSxJQUFJRSxHQUFRLEVBQ1osU0FBVS9DLEtBQUtVLGNBQWUsQ0FDMUIsTUFBTXNDLEVBQUloRCxLQUFLSyxHQUFHaUMsaUJBQWlCVyxPQUNuQyxJQUNJLElBQUksSUFBSUosRUFBRSxFQUFFQSxFQUFFRyxFQUFFSCxJQUFJLENBQ2hCLE1BQU1LLEVBQVNsRCxLQUFLSyxHQUFHaUMsaUJBQWlCYSxLQUFLTixHQUd2QzVDLEVBREtELEtBQUtLLEdBQUdrQixZQUFZLENBQUMyQixHQUFVLGFBQWExQixZQUFZMEIsR0FDcERFLFFBRWYsVUFBVSxJQUFJekMsU0FBaUJDLElBQ3ZCWCxFQUFJYSxVQUFXVixJQUNYUSxHQUFJLElBRVJYLEVBQUkrQixRQUFTNUIsSUFDVFEsR0FBSSxPQUlaLEtBQU0sR0FBR3NDLGdCQUdqQkgsR0FBUSxFQUNYLE1BQU0zQyxHQUNIc0IsUUFBUUMsTUFBTXZCLElBR3RCLE9BQU8yQyxFQUdYLGFBQWEvQixFQUFnQnFDLEdBQ3pCLFNBQVVyRCxLQUFLVSxjQUNYLElBQ0ksTUFBTVQsRUFBTUQsS0FBS0ssR0FBR2tCLFlBQVksQ0FBQ1AsR0FBUyxhQUNyQ1EsWUFBWVIsR0FDWnNDLElBQUlELEdBRVQsYUFBYSxJQUFJMUMsU0FBaUIsQ0FBQ0MsRUFBS0MsS0FDcENaLEVBQUlhLFVBQVcsS0FDWEYsR0FBSSxJQUVSWCxFQUFJK0IsUUFBVSxLQUNWcEIsR0FBSSxPQUdkLE1BQU9SLEdBR0wsT0FGQXNCLFFBQVFDLE1BQU0sb0JBQ2RELFFBQVFDLE1BQU12QixJQUNQLEdBV25CLHdCQUF3QlksRUFBZ0J1QyxFQUFhQyxHQUVqRCxNQUFNaEMsRUFBY3hCLEtBQUtLLEdBQUdrQixZQUFZLENBQUNQLEdBQVMsYUFBYVEsWUFBWVIsR0FFM0UsT0FBSVEsUUFDeUIsSUFBS2IsU0FBaUIsQ0FBQ0MsRUFBS0MsS0FDakRXLEVBQVlpQyxPQUFPRixHQUFLekMsVUFBYVYsSUFFakMsSUFBSW1ELEVBQU0vQixFQUFZbEIsT0FDaEJNLElBQU4yQyxhQU1TLElBQUs1QyxTQUFpQixDQUFDQyxFQUFLQyxLQUNyQyxNQUFNWixFQUFNdUIsRUFBWWtDLElBQUlGLEVBQUtELEdBRWpDdEQsRUFBSWEsVUFBYVYsSUFDYlEsR0FBSSxJQUdSWCxFQUFJK0IsUUFBVzVCLElBQ1hzQixRQUFRQyxNQUFNLDZCQUE2QjNCLEtBQUtKLGdCQUFnQjJELEtBQ2hFN0IsUUFBUUMsTUFBTXZCLEdBQ2RRLEdBQUksYUFJQyxJQUFLRCxTQUFpQixDQUFDQyxFQUFLQyxLQUNyQyxNQUFNWixFQUFNdUIsRUFBWThCLElBQUlFLEVBQUtELEdBQ2pDdEQsRUFBSWEsVUFBYVYsSUFDYlEsR0FBSSxJQUdSWCxFQUFJK0IsUUFBVzVCLElBQ1hzQixRQUFRQyxNQUFNLDZCQUE2QjNCLEtBQUtKLGdCQUFnQjJELEtBQ2hFN0IsUUFBUUMsTUFBTXZCLEdBQ2RRLEdBQUksUUFLaEJjLFFBQVFpQyxJQUFJLGVBQWdCM0MsSUFDckIsR0FJZixXQUFXQSxFQUFnQjRDLEdBQ3ZCLFNBQVU1RCxLQUFLVSxjQUNYLGFBQWFWLEtBQUs2RCxNQUFNN0MsRUFBUTRDLEdBU2hDLFlBQVk1QyxFQUFnQjRDLEdBQ2hDLElBQ0ksTUFDTXBDLEVBRGN4QixLQUFLSyxHQUFHa0IsWUFBWSxDQUFDUCxJQUNUUSxZQUFZUixHQUM1QyxHQUFJNEMsRUFBWSxDQUNaLE1BQU0zRCxFQUFNdUIsRUFBWXNDLElBQUlGLEdBQzVCLGFBQWEsSUFBSWpELFNBQWNDLElBQzNCWCxFQUFJYSxVQUFXVixJQUVYUSxFQUFJUixFQUFFMkIsT0FBT3pCLFNBRWpCTCxFQUFJK0IsUUFBUzVCLElBQ1RRLE9BQUltRCxPQUlaLGFBQWEsSUFBSXBELFNBQWNDLElBQzNCLElBQUlvRCxFQUFHeEMsRUFBWXlDLFNBQ25CRCxFQUFFbEQsVUFBV1YsSUFFVFEsRUFBSVIsRUFBRTJCLE9BQU96QixTQUVqQjBELEVBQUVoQyxRQUFTNUIsSUFDUFEsT0FBSW1ELE9BSWxCLE1BQU8zRCxHQUNMc0IsUUFBUUMsTUFBTXZCLElBSWQsY0FBY1ksRUFBZ0JrRCxHQUNsQyxTQUFVbEUsS0FBS1UsY0FDWCxJQUNJLE1BQU1ULEVBQU1ELEtBQUtLLEdBQUdrQixZQUFZLENBQUNQLEdBQVMsYUFDckNRLFlBQVlSLEdBQ1owQyxJQUFJUSxHQUVULGFBQWEsSUFBSXZELFNBQWlCQyxJQUM5QlgsRUFBSWEsVUFBV1YsSUFDWFEsR0FBSSxJQUVSWCxFQUFJK0IsUUFBUzVCLElBQ1RRLEdBQUksT0FHZCxNQUFPUixHQUdMLE9BRkFzQixRQUFRQyxNQUFNLG9CQUNkRCxRQUFRQyxNQUFNdkIsSUFDUCxHQU1uQixhQUFhWSxFQUFnQm1ELEVBQW9CQyxFQUE0Q0MsR0FDekYsTUFBTWIsUUFBWXhELEtBQUtzRSxLQUFLdEQsRUFBUW1ELEdBQ3BDLEdBQUtYLEVBT0UsQ0FDSCxNQUFNVSxRQUF5QkUsRUFBcUJaLEdBQ3BELFFBQUtVLFNBR1lsRSxLQUFLdUUsUUFBUXZELEVBQVFrRCxHQVh0QyxRQUFHRyxTQUNjckUsS0FBS3dFLE9BQU94RCxFQUFPcUQsR0FnQjVDLGFBQWFyRCxFQUFnQjRDLEdBQ3pCLFNBQVU1RCxLQUFLVSxjQUFlLENBQzFCLE1BQU1ULEVBQU1ELEtBQUtLLEdBQUdrQixZQUFZLENBQUNQLEdBQVMsYUFDckNRLFlBQVlSLEdBQ1p5RCxPQUFPYixHQUVaLGFBQWEsSUFBSWpELFNBQWlCQyxJQUM5QlgsRUFBSWEsVUFBV1YsSUFDWFEsR0FBSSxJQUVSWCxFQUFJK0IsUUFBUzVCLElBQ1RRLEdBQUksUUFNcEIsV0FBY0ksRUFBYzBELEVBQWtCekMsR0FDMUMsTUFBTTNCLEVBQVcsR0FDakIsU0FBU04sS0FBS1UsY0FBYyxDQUN4QixNQUNNaUUsRUFESTNFLEtBQUtLLEdBQUdrQixZQUFZLENBQUNQLEdBQVEsWUFBWVEsWUFBWVIsR0FDOUMyRCxNQUFNRCxHQUN2QixHQUFHQyxFQUFNLENBQ0wsTUFBTUMsRUFBUUMsWUFBWUMsS0FBSzdDLFNBQ3pCLElBQUl0QixTQUFjQyxJQUNwQitELEVBQU05QyxXQUFXK0MsR0FBTzlELFVBQVdWLElBRS9CLE1BQU0yRSxFQUFvQjNFLEVBQUUyQixPQUFPekIsT0FDaEN5RSxHQUVDekUsRUFBTzBFLEtBQUtELEVBQU85QyxPQUNuQjhDLEVBQU9FLFlBRVByRSxTQU1wQixPQUFPTixJRmxWYSxlQ3JCUyxFQUFFLENBQUMsQ0FBQ2EsS0FBS3pCLEVBQWErQyxlQUFlLE1BQU1HLFFBQVEsQ0FBQyxZQUFZLFFBQVEsZUFBZSxtQkFFdEhzQyxFQUFpQixJQUFJQyxlQUE2QixDQUNwREMsTUFBT0MsSUFDSEMsVUFBV2xGLElBQ1BpRixFQUFXRSxRQUFRbkYsT0FzQi9CLE1BQU1vRixFQTBJRixrQkFBa0JDLEdBRWQsTUFBTUMsUUFBbUMvRixFQUFJZ0csS0FBSyxFQUFPLFFBQVEsU0FDakUsR0FBR0QsRUFBVXpDLE9BQU8sRUFBRSxDQUNsQnlDLEVBQVVFLE1BQUssQ0FBQ0MsRUFBRUMsSUFDUEQsRUFBRUUsYUFBYUQsRUFBRUMsZUFFNUIsSUFBSSxJQUFJQyxLQUFNTixFQUNWTyxZQUFZLENBQUM3RCxLQUFLM0MsRUFBcUJ5RyxTQUFVQyxLQUFLSCxJQUs5RCxHQUFHUCxHQUEyQixFQUFFLENBQzVCLE1BQU1XLFFBQW9DekcsRUFBSWdHLEtBQUssRUFBTyxRQUFRLFFBQ2xFLEdBQUdTLEVBQVNuRCxPQUFPLEVBQUUsQ0FDakJtRCxFQUFTUixNQUFLLENBQUNDLEVBQUVDLElBQ05ELEVBQUVFLGFBQWFELEVBQUVDLGVBRTVCLElBQUksSUFBSU0sS0FBTUQsRUFDUEMsRUFBR04sY0FBY04sU0FFVjlGLEVBQUk4RSxPQUFPLEVBQU80QixFQUFHQyxRQS9KeEMsRUFBQUMsUUFBUUMsVUFDUCxVQUFVLElBQUlwRyxLQW5CMUJvRyxrQkFDSSxNQUFNQyxFQUFTdkIsRUFBZXdCLFlBQzlCLElBQ0ksT0FBVyxDQUNQLE1BQU0sS0FBQ0MsRUFBSSxNQUFFMUUsU0FBZXdFLEVBQU9uQyxPQUNuQyxHQUFHcUMsRUFBSyxDQUNKakYsUUFBUWtGLEtBQUssZ0RBQ2IsWUFFTTNFLEcsUUFJZHdFLEVBQU9JLGVBTWdCQyxHQUNmLEdBQUcxRyxFQUFFLENBQ0QsTUFBTStGLEVBQU8vRixFQUFFK0YsS0FBS0EsS0FDZFksRUFBNkIzRyxFQUFFK0YsS0FBSy9ELEtBQzFDLE9BQVEyRSxHQUNKLEtBQUt2SCxFQUFtQndILHNCQUNYckgsRUFBSXNILHVCQUNUaEIsWUFBWSxDQUFDN0QsS0FBSzNDLEVBQXFCdUgsZ0JBQWdCYixNQUFLLElBRTVERixZQUFZLENBQUM3RCxLQUFLM0MsRUFBcUJ1SCxnQkFBZ0JiLE1BQUssSUFFbkUsTUFFRCxLQUFLM0csRUFBbUIwSCxnQkFBZ0IsQ0FDcEMsTUFBTUMsRUFBaUJoQixFQUFLZ0IsUUFDNUIsSUFBSW5CLFFBQTJCckcsRUFBSTJFLEtBQUssRUFBTzZDLEdBQy9DbEIsWUFBWSxDQUFDN0QsS0FBSzNDLEVBQXFCMkgsWUFBYWpCLEtBQUtILElBQzVELE1BRUQsS0FBS3hHLEVBQW1CNkgsZUFDeEIsSUFBSTVCLEVBQWlDckYsRUFBRStGLEtBQUtWLGdDQUN0Q0QsRUFBYzhCLEtBQUs3QixHQUN6QixNQUVBLEtBQUtqRyxFQUFtQitILGtCQUFrQixDQUN0QyxNQUFNSixFQUFpQmhCLEVBQUtnQixRQUN0QkssRUFBd0JyQixFQUFLc0IsWUFDN0I5SCxFQUFJK0gsT0FBTyxFQUFPUCxHQUFTUSxJQUMxQnJJLEVBQWNzSSxJQUFJSixLQUNqQkcsRUFBVUUsTUFBTSxRQUdwQixNQUFNQyxHQUFNLElBQUlDLE1BQU9DLFVBSXZCLEdBSEFMLEVBQVVNLGFBQWFILEVBQ3ZCSCxFQUFVTyxhQUFhSixHQUFLLGtCQUFrQk4sY0FBc0JHLEVBQVVGLFNBRS9ELFNBQVpELEVBQW1CLENBQ2xCLE1BQU1XLEVBQVVSLEVBQVVTLE1BQzFCVCxFQUFVUyxNQUFNVCxFQUFVVSxXQUMxQlYsRUFBVVcsV0FBV1gsRUFBVVksZ0JBQy9CWixFQUFVTyxhQUFhSixFQUFJLEdBQUcsa0JBQWtCSCxFQUFVVSx1QkFBdUJGLEtBSXJGLE9BRkFSLEVBQVVGLE1BQU1ELEVBRVRHLEtBR2YsTUFFQSxLQUFLbkksRUFBbUJnSixrQkFBbUIsQ0FDdkMsTUFBTXJCLEVBQWlCaEIsRUFBS2dCLFFBQ3RCc0IsRUFBb0J0QyxFQUFLaUMsTUFDekJNLEVBQXFCdkMsRUFBS21DLGlCQUUxQjNJLEVBQUkrSCxPQUFPLEVBQU9QLEdBQVNRLElBQzdCLE1BQU1HLEdBQU0sSUFBSUMsTUFBT0MsVUFDdkJMLEVBQVVNLGFBQWFILEVBQ3ZCSCxFQUFVTyxhQUFhSixHQUFLLGtCQUFrQlcsY0FBc0JkLEVBQVVTLFNBQzlFVCxFQUFVRixNQUFNLFdBQ2hCRSxFQUFVUyxNQUFNSyxFQUNoQmQsRUFBVVcsV0FBV0ksRUFFckIsTUFBTUMsRUFBZ0MsQ0FDbENDLFVBQVVqQixFQUFVaUIsVUFDcEJILFlBQ0FDLGtCQUlKLE9BRkF6QyxZQUFZLENBQUM3RCxLQUFLM0MsRUFBcUJvSixhQUFjMUMsS0FBS3dDLElBRW5EaEIsS0FHZixNQUVBLEtBQUtuSSxFQUFtQnNKLFlBQWEsQ0FDakMsTUFBTUYsRUFBa0J6QyxFQUFLeUMsVUFDdkJHLEVBQXdCNUMsRUFBSzRDLFFBQ25DLEdBQWUsc0JBQVpBLEdBR0MsVUFENEJwSixFQUFJZ0csS0FBSyxFQUFPLFlBQVlpRCxJQUN2QzNGLE9BQU8sRUFDcEIsV0FFRixHQUFlLDZCQUFaOEYsRUFBdUMsQ0FDNUMsTUFBTUMsUUFBc0JySixFQUFJZ0csS0FBb0IsRUFBTyxRQUFRLFNBQ25FLEdBQUdxRCxFQUFjL0YsT0FBTyxHQUVaK0YsRUFBY0MsUUFBTzdJLEdBQUdBLEVBQUVlLE9BQU95SCxJQUNwQzNGLE9BQU8sRUFDUixNQUlaLE1BQU1pRyxFQUFtQi9DLEVBQUsrQyxVQUN4QmIsRUFBa0JsQyxFQUFLa0MsV0FDdkJFLEVBQXVCcEMsRUFBS29DLGdCQUc1QlQsR0FBTSxJQUFJQyxNQUFPQyxVQUNqQkUsRUFBd0IsR0FDOUJBLEVBQWFKLEdBQUssc0JBQ2xCSSxFQUFhSixFQUFJLEdBQUcsa0JBQWtCTyxJQUV0QyxNQUFNL0IsRUFBS0gsRUFBS0csSUFDVk4sRUFBb0IsQ0FDdEI0QyxZQUFVTSxZQUFVYixhQUFXRSxrQkFBZ0JRLFVBQy9DekMsTUFDQVAsYUFBYStCLEVBQ2JNLE1BQU1DLEVBQ05DLFdBQVdDLEVBQ1hkLE1BQU0sT0FDTkksTUFBTSxRQUNOSSxhQUFhSCxFQUNiSSxzQkFHS3ZJLEVBQUk2RSxPQUFPLEVBQU93QixJQUN2QkMsWUFBWSxDQUFDN0QsS0FBSzNDLEVBQXFCeUcsU0FBVUMsS0FBS0gsSUFHOUQsTUFDQSxLQUFLeEcsRUFBbUIySixXQUFXLENBRS9CLE1BQU0sUUFBQ2hDLEdBQVNoQixFQUNWSCxRQUEyQnJHLEVBQUkyRSxLQUFLLEVBQU82QyxHQUM5Q25CLEdBQWlCLFNBQVhBLEVBQUc2QixPQUNSNUIsWUFBWSxDQUFDN0QsS0FBSzNDLEVBQXFCeUcsU0FBVUMsS0FBS0gsSUFFN0QsTUFDRCxRQUFTLEtBQU0saUJBQWlCZSxrQ0FxQ3hEdkIsRUFBY2UsVyIsImZpbGUiOiJ0YXNrdGhlbXdlYndvcmtlci5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogKiBXSUxMX1FVRVVFIDogTXVsdGlwbGUgdGFzayBjYW4gZXhpc3QgaW4gcHJvY2Vzc2luZyBxdWV1ZS5cbiAqICogT05MWV9PTkNFX0lOX0xJRkU6IE9uZSBjYW4gY3JlYXRlIG9ubHkgb25lIHN1Y2ggdGFzay4gVW5sZXNzIHlvdSBkZWxldGUgdGhlIHRhc2sgcnVubmVyIHRhc2ssIHdoaWNoIHlvdSBkb24ndCBkbyBldmVyIVxuICogKiBPTkxZX09ORV9BQ1RJVkVfSU5fUVVFVUU6IElmIGl0cyBjcmVhdGVkIG11bHRpcGxlIHRpbWVzLCB0aGVuIG9ubHkgb25lIHdpbGwgcmVtYWluIGFjdGl2ZSBhdCBhIHRpbWUuXG4gKi9cbmV4cG9ydCB0eXBlIFRBU0tfQkVIQVZJT1IgPSBcIldJTExfUVVFVUVcInxcIk9OTFlfT05DRV9JTl9MSUZFXCJ8XCJPTkxZX09ORV9BQ1RJVkVfSU5fUVVFVUVcIjtcbi8qKlxuICogVGhpcyBzdGF0ZSBpcyB1c2VkIGJ5IHRoZSBUYXNrIHJ1bm5lciB0byBjaGVjayB3aGljaCB0YXNrIG5lZWRzIHRvIGJlIHBpY2tlZC4gRm9yIGV4YW1wbGU6XG4gKiAqIENPTVBMRVRFRDogbWVhbnMgdGhhdCBhbGwgd2VudCBnb29kIGFzIGRlc2lyZWQuIENvbXBsZXRlZCB0YXNrIGFyZSBub3QgcGlja2VkIHVwIGFnYWluLlxuICogKiBGQUlMRUQ6IE1lYW5zIHRoYXQgdGFzayBpcyBpbiBzdGF0ZSBvZiBubyByZWNvdmVyeSBhbmQgaGFzIGZhaWxlZC5cbiAqICogQ09OVElOVUU6IG1lYW5zIHlvdSB3aWxsIHdhbnQgdG8gY29udGludWUgdGhlIHRhc2sgbmV4dCB0aW1lICh0aGlzIHRhc2sgaXMgbWFkZSB0byBydW4gZHVyaW5nIGluaXQgcHJvY2VzcyBvZiBzY2hlZHVsZXIpLCBidXQgc3RvcCBpdCBhcyBvZiBub3cuXG4gKi9cbmV4cG9ydCB0eXBlIFRBU0tfU1RBVEU9XCJJTklUXCJ8XCJDT05USU5VRVwifFwiQ09NUExFVEVEXCJ8XCJGQUlMRURcIjtcblxuZXhwb3J0IGNvbnN0IEVORElOR19TVEFURVM6U2V0PFRBU0tfU1RBVEU+PW5ldyBTZXQ8VEFTS19TVEFURT4oW1wiQ09NUExFVEVEXCIsXCJGQUlMRURcIl0pO1xuXG4vKipcbiAqIGdldHMgY2FsbGVkIGZvciB0YXNrIGVuZGluZyBzdGF0ZXM6IENPTVBMRVRFRCBvciBGQUlMRURcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBTdGF0ZUNoYW5nZUhhbmRsZXJ7XG4gICAgKHN0YXRlOlRBU0tfU1RBVEUsIHRhc2tfaWQ6c3RyaW5nKTpQcm9taXNlPGFueT47XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVGFza1J1bm5lckVudHJ5e1xuICAgIF9pZDpzdHJpbmc7XG4gICAgLyoqXG4gICAgICogU2hvcnQgdW5pcXVlIG5hbWUgd2hpY2ggbWFrZSBpdHMgaW50ZW50IGNsZWFyLlxuICAgICAqL1xuICAgIHRhc2tfbmFtZTogc3RyaW5nO1xuICAgIC8qKlxuICAgICAqIERldGFpbGVkIGRlc2NyaXB0aW9uIG9mIHdoYXQgdGFzayBpcyBpbnRlbmRlZCB0byBkb1xuICAgICAqL1xuICAgIHRhc2tfZGVzYzpzdHJpbmc7XG4gICAgXG4gICAgLyoqXG4gICAgICogRGF0ZSBvbiB3aGljaCB0aGlzIHRhc2sgd2FzIGNyZWF0ZWQsIGluIG1pbGxpc2Vjb25kcyBzaW5jZSBVbml4IEVwb2NoLlxuICAgICAqL1xuICAgIGNyZWF0ZWRfZGF0ZTogbnVtYmVyO1xuXG5cbiAgICBiZWhhdmVzOiBUQVNLX0JFSEFWSU9SO1xuICAgIFxuXG4gICAgc3RhdGU6IFRBU0tfU1RBVEU7XG4gICAgLyoqXG4gICAgICogaWYgc2V0IHRydWUgdGFzayB3aWxsIG5vIG1vcmUgYmUgcGlja2VkLiBJdHMgc2V0IGFzIHRydWUgb24gZmFpbGVkIG9yIGNvbXBsZXRlLlxuICAgICAqL1xuICAgIGVuZGVkOlwidHJ1ZVwifFwiZmFsc2VcIjtcblxuXG4gICAgaW5pdF9waGFzZTpzdHJpbmc7XG5cbiAgICAvKipcbiAgICAgKiBBbnkgX2luaXQgZGF0YSB0byBiZSBwYXNzZWQgdG8gdGFzay4gVGhpcyBkYXRhIGNhbm5vdCBiZSBtb2RpZmllZCBieSB0aGUgdGFzay5cbiAgICAgKi9cbiAgICBpbml0X3BoYXNlX2RhdGE6IGFueTtcbiAgICBcbiAgICAvKipcbiAgICAgKiBDYW5ub3QgYmUgZmFsc3kuXFxcbiAgICAgKiBUaGlzIGFyZSBUYXNrIHNwZWNpZmljIHBoYXNlICwgZm9yIGV4YW1wbGUgZm9yIGluaXRpYWxpemluZyBhbiBhcHAgZm9sbG93aW5nIGNhbiBiZSBpdHMgcGhhc2VcbiAgICAgKiAqIElOSVRJQUxJWkVfREJcbiAgICAgKiAqIFNZTkNfREFUQVxuICAgICAqICogRE9fU0FOSVRZX0NIRUNLU1xuICAgICAqIEl0cyBzdWdnZXN0ZWQgdG8gdXNlIHRoaXMgcGhhc2UgbGlrZSB0aGlzOlxuICAgICAqIGBgYGpzXG4gICAgICogc3dpdGNoKHBoYXNlKXtcbiAgICAgKiAgY2FzZSBcIklOSVRJQUxJWkVfREJcIjpcbiAgICAgKiAgICAgICAgIHRoaXMuaW5pdGlhbGl6ZURCKClcbiAgICAgKiAgY2FzZSBcIlNZTkNfREFUQVwiOlxuICAgICAqICAgICAgICAgIHRoaXMuc3luY19kYXRhKCk7XG4gICAgICogfVxuICAgICAqIGBgYFxuICAgICAqL1xuICAgIHBoYXNlOiBzdHJpbmc7XG5cbiAgICAvKipcbiAgICAgKiBFYWNoIHBoYXNlIG9uY2UgY29tcGxldGVzIGhhcyBhIHN0YXRlIG9mIGRhdGEsIHdoaWNoIGNhbiBiZSBzYXZlZCBpbiBoZXJlLiBJdHMgY2FuIGJlIHVzZWQgdG8gc3RhcnQgYSB0YXNrIGZyb20gd2hlZSBldmVyIGl0IGxlZnQgb2ZmLlxuICAgICAqL1xuICAgIHBoYXNlX2RhdGE6IGFueTtcbiAgICAvKipcbiAgICAgKiBEYXRlIG9uIHdoaWNoIHRoaXMgdGFzayB3YXMgbW9kaWZpZWQsIGluIG1pbGxpc2Vjb25kcyBzaW5jZSBVbml4IEVwb2NoLlxuICAgICAqL1xuICAgIHVwZGF0ZWRfZGF0ZTpudW1iZXI7XG4gICAgLyoqXG4gICAgICogVXBkYXRlIGxvZ3Mgd2lsbCBiZSBzYXZlZCBpbiBoZXJlLlxuICAgICAqIHtcbiAgICAgKiAgMTIzMTIzMTEyMzpbXCJ1cGRhdGVkIHNvbWV0aGluZzFcIixcInVwZGF0ZWQgc29tZXRoaW5nIDJcIl1cbiAgICAgKiB9XG4gICAgICovXG4gICAgdXBkYXRlc19sb2dzOiBVcGRhdGVMb2dzO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFVwZGF0ZUxvZ3N7W2RhdGU6bnVtYmVyXTpzdHJpbmd9XG5cblxuZXhwb3J0IGludGVyZmFjZSBQaGFzZUNoYW5nZURhdGF7XG4gICAgdGFza19uYW1lOnN0cmluZywgbmV3X3BoYXNlOnN0cmluZywgbmV3X3BoYXNlX2RhdGE/OmFueVxufSIsImltcG9ydCB7IERBTyB9IGZyb20gXCIuL2Rhb1wiO1xuXG5leHBvcnQgZW51bSBUYXNrTWFuYWdlck1lc3NhZ2V7XG4gICAgSU5JVF9XRUJXT1JLRVI9XCJJTklUX1dFQldPUktFUlwiLFxuICAgIENIQU5HRV9UQVNLX1NUQVRFPVwiQ0hBTkdFX1RBU0tfU1RBVEVcIixcbiAgICBDSEFOR0VfVEFTS19QSEFTRT1cIkNIQU5HRV9UQVNLX1BIQVNFXCIsXG4gICAgQ1JFQVRFX1RBU0s9XCJDUkVBVEVfVEFTS1wiLFxuICAgIFJVTl9BX1RBU0s9XCJSVU5fQV9UQVNLXCIsXG4gICAgR0VUX1RBU0tfU1RBVFVTPVwiR0VUX1RBU0tfU1RBVFVTXCIsXG4gICAgLyoqXG4gICAgICogQ2xlYXJzIGFsbCB0YXNrcy5cbiAgICAgKi9cbiAgICBDTEVBUl9UQVNLX1RIRU09XCJDTEVBUl9UQVNLX1RIRU1cIlxufVxuXG4vL09iamVjdC5mcmVlemUoVGFza01hbmFnZXJNZXNzYWdlKTtcblxuZXhwb3J0IGVudW0gVGFza1NjaGVkdWxlck1lc3NhZ2V7XG4gICAgUlVOX1RBU0s9XCJSVU5fVEFTS1wiLFxuICAgIFRBU0tfU1RBVFVTPVwiVEFTS19TVEFUVVNcIixcbiAgICBDTEVBUl9UQVNLX1RIRU09XCJDTEVBUl9UQVNLX1RIRU1cIixcbiAgICBQSEFTRV9DSEFOR0U9XCJQSEFTRV9DSEFOR0VcIlxufVxuXG5leHBvcnQgY29uc3QgVEFTS19USEVNX0RCID0gXCJUQVNLX1RIRU1fREJcIjtcbmV4cG9ydCBjb25zdCB0YXNrX3RoZW1fb3MgPSBcIl90YXNrX3RoZW1fZW50cmllc1wiO1xuXG4vL09iamVjdC5mcmVlemUoVGFza1NjaGVkdWxlck1lc3NhZ2UpOyIsImltcG9ydCB7RU5ESU5HX1NUQVRFUyxEQU8sIFRBU0tfVEhFTV9EQiwgdGFza190aGVtX29zLCBQaGFzZUNoYW5nZURhdGF9IGZyb20gJy4uL2xpYic7XG5pbXBvcnQgeyBUYXNrUnVubmVyRW50cnksIFRBU0tfQkVIQVZJT1IsIFRBU0tfU1RBVEUsIFVwZGF0ZUxvZ3MsIFRhc2tNYW5hZ2VyTWVzc2FnZSwgVGFza1NjaGVkdWxlck1lc3NhZ2UsdGFza190aGVtX29zIGFzIGRibmFtZSB9IGZyb20gJy4uL2xpYic7XG5cbmNvbnN0IGRhbzpEQU8gPSBuZXcgREFPKFRBU0tfVEhFTV9EQiwxLFt7bmFtZTp0YXNrX3RoZW1fb3MscHJpbWFyeUtleU5hbWU6XCJfaWRcIixpbmRleGVzOltcInRhc2tfbmFtZVwiLFwiZW5kZWRcIixcImNyZWF0ZWRfZGF0ZVwiLFwidXBkYXRlZF9kYXRlXCJdfV0pO1xuXG5jb25zdCBtc2dFdmVudFN0cmVhbSA9IG5ldyBSZWFkYWJsZVN0cmVhbTxNZXNzYWdlRXZlbnQ+KHtcbiAgICBzdGFydDooY29udHJvbGxlcik9PntcbiAgICAgICAgb25tZXNzYWdlPShlKT0+e1xuICAgICAgICAgICAgY29udHJvbGxlci5lbnF1ZXVlKGUpO1xuICAgICAgICB9XG4gICAgfSAgXG59KTtcblxuYXN5bmMgZnVuY3Rpb24qIG1lc3NhZ2VFdmVudEdlbmVyYXRvcigpe1xuICAgIGNvbnN0IHJlYWRlciA9IG1zZ0V2ZW50U3RyZWFtLmdldFJlYWRlcigpO1xuICAgIHRyeXtcbiAgICAgICAgd2hpbGUodHJ1ZSl7XG4gICAgICAgICAgICBjb25zdCB7ZG9uZSwgdmFsdWV9ID0gYXdhaXQgcmVhZGVyLnJlYWQoKTtcbiAgICAgICAgICAgIGlmKGRvbmUpe1xuICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybihcIlRoaXMgc2hvdWxkIG5vdCBlbmQgYW5kIHNob3VsZCBrZWVwIHJ1bm5pbmchXCIpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgICAgeWllbGQgdmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9ZmluYWxseXtcbiAgICAgICAgcmVhZGVyLnJlbGVhc2VMb2NrKCk7XG4gICAgfVxufVxuXG5jbGFzcyBUYXNrU2NoZWR1bGVye1xuICAgIHN0YXRpYyBwcm9jZXNzPWFzeW5jICgpPT57XG4gICAgICAgICAgICBmb3IgYXdhaXQobGV0IGUgb2YgbWVzc2FnZUV2ZW50R2VuZXJhdG9yKCkpe1xuICAgICAgICAgICAgICAgIGlmKGUpe1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBkYXRhID0gZS5kYXRhLmRhdGE7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG1zZ1R5cGU6VGFza01hbmFnZXJNZXNzYWdlID0gZS5kYXRhLnR5cGU7XG4gICAgICAgICAgICAgICAgICAgIHN3aXRjaCAobXNnVHlwZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBUYXNrTWFuYWdlck1lc3NhZ2UuQ0xFQVJfVEFTS19USEVNOntcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihhd2FpdCBkYW8uY2xlYW5BbGxPYmplY3RTdG9yZXMoKSl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc3RNZXNzYWdlKHt0eXBlOlRhc2tTY2hlZHVsZXJNZXNzYWdlLkNMRUFSX1RBU0tfVEhFTSxkYXRhOnRydWV9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zdE1lc3NhZ2Uoe3R5cGU6VGFza1NjaGVkdWxlck1lc3NhZ2UuQ0xFQVJfVEFTS19USEVNLGRhdGE6ZmFsc2V9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9YnJlYWs7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgVGFza01hbmFnZXJNZXNzYWdlLkdFVF9UQVNLX1NUQVRVUzp7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdGFza19pZDpzdHJpbmcgPSBkYXRhLnRhc2tfaWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHRlOlRhc2tSdW5uZXJFbnRyeSA9IGF3YWl0IGRhby5yZWFkKGRibmFtZSx0YXNrX2lkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3N0TWVzc2FnZSh7dHlwZTpUYXNrU2NoZWR1bGVyTWVzc2FnZS5UQVNLX1NUQVRVUywgZGF0YTp0ZX0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfWJyZWFrO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFRhc2tNYW5hZ2VyTWVzc2FnZS5JTklUX1dFQldPUktFUjogXG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgYXJjaGl2ZV9lbmRlZF90YXNrX2JlZm9yZTpudW1iZXI9ZS5kYXRhLmFyY2hpdmVfZW5kZWRfdGFza19iZWZvcmU7XG4gICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBUYXNrU2NoZWR1bGVyLmluaXQoYXJjaGl2ZV9lbmRlZF90YXNrX2JlZm9yZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBUYXNrTWFuYWdlck1lc3NhZ2UuQ0hBTkdFX1RBU0tfU1RBVEU6e1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRhc2tfaWQ6c3RyaW5nID0gZGF0YS50YXNrX2lkO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG5ld19zdGF0ZTogVEFTS19TVEFURSA9IGRhdGEuc3RhdGU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgZGFvLnVwZGF0ZShkYm5hbWUsdGFza19pZCwob2xkT2JqZWN0OlRhc2tSdW5uZXJFbnRyeSk9PntcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoRU5ESU5HX1NUQVRFUy5oYXMobmV3X3N0YXRlKSl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbGRPYmplY3QuZW5kZWQ9XCJ0cnVlXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbGRPYmplY3QudXBkYXRlZF9kYXRlPW5vdztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2xkT2JqZWN0LnVwZGF0ZXNfbG9nc1tub3ddPWBTVEFURSBDSEFOR0VEOiAke25ld19zdGF0ZX0gLCBmcm9tOiA8JHtvbGRPYmplY3Quc3RhdGV9PmA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihuZXdfc3RhdGU9PT1cIklOSVRcIil7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBvbGRfcGhhc2U9b2xkT2JqZWN0LnBoYXNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2xkT2JqZWN0LnBoYXNlPW9sZE9iamVjdC5pbml0X3BoYXNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2xkT2JqZWN0LnBoYXNlX2RhdGE9b2xkT2JqZWN0LmluaXRfcGhhc2VfZGF0YTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9sZE9iamVjdC51cGRhdGVzX2xvZ3Nbbm93KzFdPWBQSEFTRSBDSEFOR0VEOiAke29sZE9iamVjdC5pbml0X3BoYXNlfSAsIGZyb206IDwke29sZF9waGFzZX0+YDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbGRPYmplY3Quc3RhdGU9bmV3X3N0YXRlO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBvbGRPYmplY3Q7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgVGFza01hbmFnZXJNZXNzYWdlLkNIQU5HRV9UQVNLX1BIQVNFOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdGFza19pZDpzdHJpbmcgPSBkYXRhLnRhc2tfaWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbmV3X3BoYXNlOiBzdHJpbmcgPSBkYXRhLnBoYXNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG5ld19waGFzZV9kYXRhOmFueSA9IGRhdGEucGhhc2VfZGF0YTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IGRhby51cGRhdGUoZGJuYW1lLHRhc2tfaWQsKG9sZE9iamVjdDpUYXNrUnVubmVyRW50cnkpPT57XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbGRPYmplY3QudXBkYXRlZF9kYXRlPW5vdztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2xkT2JqZWN0LnVwZGF0ZXNfbG9nc1tub3ddPWBQSEFTRSBDSEFOR0VEOiAke25ld19waGFzZX0gLCBmcm9tOiA8JHtvbGRPYmplY3QucGhhc2V9PmA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9sZE9iamVjdC5zdGF0ZT1cIkNPTlRJTlVFXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9sZE9iamVjdC5waGFzZT1uZXdfcGhhc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9sZE9iamVjdC5waGFzZV9kYXRhPW5ld19waGFzZV9kYXRhO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcGhhc2VDaGFuZ2VEYXRhOlBoYXNlQ2hhbmdlRGF0YT17XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrX25hbWU6b2xkT2JqZWN0LnRhc2tfbmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld19waGFzZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld19waGFzZV9kYXRhXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc3RNZXNzYWdlKHt0eXBlOlRhc2tTY2hlZHVsZXJNZXNzYWdlLlBIQVNFX0NIQU5HRSwgZGF0YTpwaGFzZUNoYW5nZURhdGF9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2xkT2JqZWN0O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFRhc2tNYW5hZ2VyTWVzc2FnZS5DUkVBVEVfVEFTSzoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRhc2tfbmFtZTpzdHJpbmc9IGRhdGEudGFza19uYW1lO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGJlaGF2ZXM6VEFTS19CRUhBVklPUiA9IGRhdGEuYmVoYXZlcztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihiZWhhdmVzID09PSBcIk9OTFlfT05DRV9JTl9MSUZFXCIpe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2NoZWNrIGlmIG9uY2Ugc3VjaCB0YXNrIGlzIGFscmVhZHkgcHJlc2VudCBpbiBEQi5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZm91bmRfZW50cmllcyA9IGF3YWl0IGRhby5maW5kKGRibmFtZSxcInRhc2tfbmFtZVwiLHRhc2tfbmFtZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGZvdW5kX2VudHJpZXMubGVuZ3RoPjApe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9ZWxzZSBpZihiZWhhdmVzID09PSBcIk9OTFlfT05FX0FDVElWRV9JTl9RVUVVRVwiKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZm91bmRfZW50cmllcyA9IGF3YWl0IGRhby5maW5kPHtuYW1lOnN0cmluZ30+KGRibmFtZSxcImVuZGVkXCIsXCJmYWxzZVwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoZm91bmRfZW50cmllcy5sZW5ndGg+MCl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2xldHMgc2VhcmNoIGlmIHF1ZXVlIGFscmVhZHkgaGF2ZSBvbmUgYWN0aXZlIG1lbWJlciBvZiB0aGlzXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgZiA9IGZvdW5kX2VudHJpZXMuZmlsdGVyKGU9PmUubmFtZT09PXRhc2tfbmFtZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihmLmxlbmd0aD4wKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0YXNrX2Rlc2M6c3RyaW5nID0gZGF0YS50YXNrX2Rlc2M7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaW5pdF9waGFzZTpzdHJpbmc9ZGF0YS5pbml0X3BoYXNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGluaXRfcGhhc2VfZGF0YTpTdHJpbmc9ZGF0YS5pbml0X3BoYXNlX2RhdGE7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB1cGRhdGVzX2xvZ3M6VXBkYXRlTG9ncz17fTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVzX2xvZ3Nbbm93XT1cIlNUQVRFIENIQU5HRUQ6IElOSVRcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVzX2xvZ3Nbbm93KzFdPWBQSEFTRSBDSEFOR0VEOiAke2luaXRfcGhhc2V9YDtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IF9pZD0gZGF0YS5faWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdGU6IFRhc2tSdW5uZXJFbnRyeT17XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2tfbmFtZSx0YXNrX2Rlc2MsaW5pdF9waGFzZSxpbml0X3BoYXNlX2RhdGEsYmVoYXZlcyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX2lkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjcmVhdGVkX2RhdGU6bm93LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwaGFzZTppbml0X3BoYXNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwaGFzZV9kYXRhOmluaXRfcGhhc2VfZGF0YSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGU6XCJJTklUXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZGVkOlwiZmFsc2VcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlZF9kYXRlOm5vdyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlc19sb2dzXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoYXdhaXQgZGFvLmNyZWF0ZShkYm5hbWUsdGUpKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zdE1lc3NhZ2Uoe3R5cGU6VGFza1NjaGVkdWxlck1lc3NhZ2UuUlVOX1RBU0ssIGRhdGE6dGV9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgVGFza01hbmFnZXJNZXNzYWdlLlJVTl9BX1RBU0s6e1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vY2hlY2sgaWYgdGFzayBpcyBlbmRlZFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHt0YXNrX2lkfT1kYXRhO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRlOlRhc2tSdW5uZXJFbnRyeSA9IGF3YWl0IGRhby5yZWFkKGRibmFtZSx0YXNrX2lkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZih0ZSAmJiB0ZS5lbmRlZCE9PVwidHJ1ZVwiKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zdE1lc3NhZ2Uoe3R5cGU6VGFza1NjaGVkdWxlck1lc3NhZ2UuUlVOX1RBU0ssIGRhdGE6dGV9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9YnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OiB0aHJvdyBgTm8gc3VjaCBjYXNlOiAke21zZ1R5cGV9IHJlZ2lzdGVyZWQgd2l0aCBzY2hlZHVsZXIhYDticmVhaztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgIH1cblxuICAgIHN0YXRpYyBhc3luYyBpbml0KGFyY2hpdmVfZW5kZWRfdGFza19iZWZvcmU6bnVtYmVyKXtcbiAgICAgICAgLy9xdWVyeSBkYXRhYmFzZSBmb3IgYWxsIHRhc2sgd2hlcmUgZW5kZWQ9ZmFsc2UgYW5kIFxuICAgICAgICBjb25zdCBmb3VuZF9uZXQ6IFRhc2tSdW5uZXJFbnRyeVtdPWF3YWl0IGRhby5maW5kKGRibmFtZSxcImVuZGVkXCIsXCJmYWxzZVwiKTtcbiAgICAgICAgaWYoZm91bmRfbmV0Lmxlbmd0aD4wKXtcbiAgICAgICAgICAgIGZvdW5kX25ldC5zb3J0KChhLGIpPT57XG4gICAgICAgICAgICAgICAgcmV0dXJuIGEuY3JlYXRlZF9kYXRlLWIuY3JlYXRlZF9kYXRlO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIGZvcihsZXQgdGUgb2YgZm91bmRfbmV0KXtcbiAgICAgICAgICAgICAgICBwb3N0TWVzc2FnZSh7dHlwZTpUYXNrU2NoZWR1bGVyTWVzc2FnZS5SVU5fVEFTSywgZGF0YTp0ZX0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy9kZWxldGluZyBlbmRlZCB0YXNrIGJlZm9yZSB0aGUgZ2l2ZW4gZGF0ZVxuICAgICAgICBpZihhcmNoaXZlX2VuZGVkX3Rhc2tfYmVmb3JlPi0xKXtcbiAgICAgICAgICAgIGNvbnN0IGZvdW5kX2V0OiBUYXNrUnVubmVyRW50cnlbXSA9IGF3YWl0IGRhby5maW5kKGRibmFtZSxcImVuZGVkXCIsXCJ0cnVlXCIpO1xuICAgICAgICAgICAgaWYoZm91bmRfZXQubGVuZ3RoPjApe1xuICAgICAgICAgICAgICAgIGZvdW5kX2V0LnNvcnQoKGEsYik9PntcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEuY3JlYXRlZF9kYXRlLWIuY3JlYXRlZF9kYXRlO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGZvcihsZXQgZXQgb2YgZm91bmRfZXQpe1xuICAgICAgICAgICAgICAgICAgICBpZihldC5jcmVhdGVkX2RhdGU8PWFyY2hpdmVfZW5kZWRfdGFza19iZWZvcmUpe1xuICAgICAgICAgICAgICAgICAgICAgICAgLy9sZXRzIGRlbGV0ZSB0aGVtXG4gICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBkYW8uZGVsZXRlKGRibmFtZSxldC5faWQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxufVxuXG5UYXNrU2NoZWR1bGVyLnByb2Nlc3MoKTsiLCJcbmV4cG9ydCBpbnRlcmZhY2UgREJEZXRhaWxze1xuICAgIG5hbWU6IHN0cmluZyxcbiAgICBwcmltYXJ5S2V5TmFtZT86IHN0cmluZztcbiAgICBpbmRleGVzPzpzdHJpbmdbXTtcbn1cblxuLyoqXG4gKiBVcGRhdGVPYmplY3RGdW5jdGlvbiBhcmUgdXNlZCB0byB1cGRhdGUgdGhlIG9iamVjdCBpbiBEQi5cbiAqIHRoZSB1cGRhdGUgZnVuY3Rpb24gb2YgYSBEQU8sIGlzIGdpdmVuIHByaW1hcnlrZXkgZm9yIG9iamVjdCBhbmQgdGhpcyB1cGRhdGUgZnVuY3Rpb24uXG4gKiB1cGRhdGUgZnVuY3Rpb24gZmlyc3Qgc2VhcmNoZXMgZm9yIHRoZSBvYmplY3QgaWYgZm91bmQgaXQgcGFzc2VzIGl0IHRvIHRoZSB1cGRhdGUgZnVuY3Rpb24gYW5kIGV4cGVjdCB0byByZWNlaXZlIHRoZSBtb2RpZmllZCBkb2MsIHdoaWNoIGl0IHRoZW4gc2F2ZXMgdG8gZGIuXG4gKiBJZiBubyBvYmplY3QgaXMgcmV0dXJuZWQgaXQgc2tpcHMgdGhlIHVwZGF0ZSBbc28gYnVzaW5lc3MgbG9naWMgY2FuIGNhbiBiZSBpbXBsZW1lbnRlZCBpbnNpZGUgdG8gYWJvcnQgb3IgcGVyZm9ybSBhbiB1cGRhdGVdXG4gKiBpZiBubyBvYmplY3QgaXMgZm91bmQgLCB0aGFuIGl0IHdpbGwgc2ltcGx5IGlnbm9yZSB0aGlzIGZ1bmN0aW9uLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIFVwZGF0ZU9iamVjdEZ1bmN0aW9uIHtcbiAgICAob2xkT2JqZWN0OiBhbnkpOiBhbnk7XG59XG5cbmV4cG9ydCBjbGFzcyBEQU8ge1xuICAgIHJlcSE6IElEQk9wZW5EQlJlcXVlc3Q7XG4gICAgZGIhOiBJREJEYXRhYmFzZTtcbiAgICBpc0luaXRpYWxpemVkITogUHJvbWlzZTxib29sZWFuPjtcblxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgZGF0YWJhc2VOYW1lOnN0cmluZywgdmVyc2lvbjogbnVtYmVyLCBsaXN0b2ZEQkRldGFpbHM6IERCRGV0YWlsc1tdKSB7XG4gICAgICAgIGlmIChpbmRleGVkREIpIHtcbiAgICAgICAgICAgIHRoaXMucmVxID0gaW5kZXhlZERCLm9wZW4oZGF0YWJhc2VOYW1lLCB2ZXJzaW9uKTtcblxuICAgICAgICAgICAgdGhpcy5yZXEub251cGdyYWRlbmVlZGVkID0gKGUpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmRiID0gdGhpcy5yZXEucmVzdWx0O1xuICAgICAgICAgICAgICAgIGxpc3RvZkRCRGV0YWlscy5mb3JFYWNoKGVsZW1lbnQgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNyZWF0ZU9iamVjdFN0b3JlKGVsZW1lbnQpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdGhpcy5pc0luaXRpYWxpemVkID0gbmV3IFByb21pc2U8Ym9vbGVhbj4oKHJlcywgcmVqKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5yZXEub25zdWNjZXNzID0gKGUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kYiA9IHRoaXMucmVxLnJlc3VsdDtcbiAgICAgICAgICAgICAgICAgICAgcmVzKHRydWUpO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHB1YmxpYyBjbG9zZVRoZURCKCkge1xuICAgICAgICB0aGlzLmRiLmNsb3NlKCk7XG4gICAgfVxuXG4gICAgcHVibGljIHN0YXRpYyBhc3luYyBjaGVja0lmREJFeGlzdChkYm5hbWU6IHN0cmluZykge1xuICAgICAgICAvL0B0cy1pZ25vcmVcbiAgICAgICAgcmV0dXJuIChhd2FpdCBpbmRleGVkREIuZGF0YWJhc2VzKCkpLm1hcChlID0+IGUubmFtZSkuaW5jbHVkZXMoZGJuYW1lKSBhcyBib29sZWFuO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIHJldHVybnMgLTEgd2hlbiBzdG9yZSBkbyBubyBleGlzdFxuICAgICAqIEBwYXJhbSBzdG9yZU5hbWUgXG4gICAgICovXG4gICAgcHVibGljIGFzeW5jIGdldENvdW50SW5TdG9yZShzdG9yZU5hbWU6IHN0cmluZykge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgdHggPSB0aGlzLmRiLnRyYW5zYWN0aW9uKFtzdG9yZU5hbWVdKTtcbiAgICAgICAgICAgIGNvbnN0IG9zID0gdHgub2JqZWN0U3RvcmUoc3RvcmVOYW1lKTtcbiAgICAgICAgICAgIGNvbnN0IHJlc3AgPSBvcy5jb3VudCgpO1xuICAgICAgICAgICAgcmV0dXJuIGF3YWl0IG5ldyBQcm9taXNlPG51bWJlcj4oKHJlcyk9PntcbiAgICAgICAgICAgICAgICByZXNwLm9uc3VjY2Vzcz0oKT0+e1xuICAgICAgICAgICAgICAgICAgICByZXMocmVzcC5yZXN1bHQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKGUpO1xuICAgICAgICAgICAgcmV0dXJuIC0xO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHVibGljIGFzeW5jIGdldExhc3RPYmplY3RGcm9tT2JqZWN0U3RvcmUoc3RvcmVOYW1lOiBzdHJpbmcpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IHR4ID0gdGhpcy5kYi50cmFuc2FjdGlvbihbc3RvcmVOYW1lXSk7XG4gICAgICAgICAgICBjb25zdCBvcyA9IHR4Lm9iamVjdFN0b3JlKHN0b3JlTmFtZSk7XG5cbiAgICAgICAgICAgIGNvbnN0IGNyID0gb3Mub3BlbkN1cnNvcihudWxsLCBcInByZXZcIik7XG4gICAgICAgICAgICBjb25zdCBjdXJzb3IgPSBhd2FpdCBuZXcgUHJvbWlzZTxJREJDdXJzb3JXaXRoVmFsdWU+KChyZXMsIHJlaikgPT4ge1xuICAgICAgICAgICAgICAgIGNyLm9uc3VjY2VzcyA9IChldikgPT4ge1xuICAgICAgICAgICAgICAgICAgICAvL0B0cy1pZ25vcmVcbiAgICAgICAgICAgICAgICAgICAgcmVzKGV2LnRhcmdldC5yZXN1bHQpO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgY3Iub25lcnJvciA9IHJlajtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIGN1cnNvcj8udmFsdWU7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwdWJsaWMgYXN5bmMgZGVsZXRlVGhlREIoKSB7XG4gICAgICAgIGlmIChhd2FpdCB0aGlzLmlzSW5pdGlhbGl6ZWQpIHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jbG9zZVRoZURCKCk7XG4gICAgICAgICAgICAgICAgY29uc3QgcmVxID0gaW5kZXhlZERCLmRlbGV0ZURhdGFiYXNlKHRoaXMuZGF0YWJhc2VOYW1lKTtcbiAgICAgICAgICAgICAgICBjb25zdCBldmVudCA9IGF3YWl0IChhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZTx7IHR5cGU6IHN0cmluZyB9PigocmVzLCByZWopID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlcS5vbnN1Y2Nlc3MgPSByZXM7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXEub25lcnJvciA9IHJlajtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSkoKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZXZlbnQudHlwZSA9PT0gJ3N1Y2Nlc3MnO1xuICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gZGVsZXRlIHRoZSBkYXRhYmFzZVwiKTtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGUpO1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIGNyZWF0ZU9iamVjdFN0b3JlKGRiZGV0YWlsOkRCRGV0YWlscykge1xuICAgICAgICBpZiAoIXRoaXMuZGIub2JqZWN0U3RvcmVOYW1lcy5jb250YWlucyhkYmRldGFpbC5uYW1lKSkge1xuICAgICAgICAgICAgbGV0IG9zOklEQk9iamVjdFN0b3JlO1xuICAgICAgICAgICAgaWYgKGRiZGV0YWlsLnByaW1hcnlLZXlOYW1lKSB7XG4gICAgICAgICAgICAgICAgb3MgPSB0aGlzLmRiLmNyZWF0ZU9iamVjdFN0b3JlKGRiZGV0YWlsLm5hbWUsIHsga2V5UGF0aDogZGJkZXRhaWwucHJpbWFyeUtleU5hbWUgfSlcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgb3MgPSB0aGlzLmRiLmNyZWF0ZU9iamVjdFN0b3JlKGRiZGV0YWlsLm5hbWUsIHsgYXV0b0luY3JlbWVudDogdHJ1ZSB9KVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYoZGJkZXRhaWwuaW5kZXhlcyl7XG4gICAgICAgICAgICAgICAgZm9yKGxldCBpIG9mIGRiZGV0YWlsLmluZGV4ZXMpe1xuICAgICAgICAgICAgICAgICAgICBvcy5jcmVhdGVJbmRleChpLGkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIGFzeW5jIGNsZWFuQWxsT2JqZWN0U3RvcmVzKCl7XG4gICAgICAgIGxldCBhbGxHb29kPWZhbHNlO1xuICAgICAgICBpZiAoYXdhaXQgdGhpcy5pc0luaXRpYWxpemVkKSB7XG4gICAgICAgICAgICBjb25zdCBsID0gdGhpcy5kYi5vYmplY3RTdG9yZU5hbWVzLmxlbmd0aDtcbiAgICAgICAgICAgIHRyeXtcbiAgICAgICAgICAgICAgICBmb3IobGV0IGk9MDtpPGw7aSsrKXtcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgb3NOYW1lID0gdGhpcy5kYi5vYmplY3RTdG9yZU5hbWVzLml0ZW0oaSk7XG4gICAgICAgIFxuICAgICAgICAgICAgICAgICAgICBjb25zdCBvcyA9IHRoaXMuZGIudHJhbnNhY3Rpb24oW29zTmFtZSFdLCAncmVhZHdyaXRlJykub2JqZWN0U3RvcmUob3NOYW1lISk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlcSA9IG9zLmNsZWFyKCk7XG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICBpZighYXdhaXQgbmV3IFByb21pc2U8Ym9vbGVhbj4ocmVzPT57XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxLm9uc3VjY2Vzcz0oZTpFdmVudCk9PntcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzKHRydWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXEub25lcnJvcj0oZTpFdmVudCk9PntcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzKGZhbHNlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICApe1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgYCR7b3NOYW1lfSBub3QgY2xlYXJlZGA7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYWxsR29vZD10cnVlO1xuICAgICAgICAgICAgfWNhdGNoKGUpe1xuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGFsbEdvb2Q7XG4gICAgfVxuXG4gICAgYXN5bmMgY3JlYXRlKGRibmFtZTogc3RyaW5nLCBvYmplY3RUb1NhdmU6IGFueSkge1xuICAgICAgICBpZiAoYXdhaXQgdGhpcy5pc0luaXRpYWxpemVkKSB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHJlcSA9IHRoaXMuZGIudHJhbnNhY3Rpb24oW2RibmFtZV0sICdyZWFkd3JpdGUnKVxuICAgICAgICAgICAgICAgICAgICAub2JqZWN0U3RvcmUoZGJuYW1lKVxuICAgICAgICAgICAgICAgICAgICAuYWRkKG9iamVjdFRvU2F2ZSk7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gYXdhaXQgbmV3IFByb21pc2U8Ym9vbGVhbj4oKHJlcywgcmVqKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHJlcS5vbnN1Y2Nlc3MgPSgpPT57XG4gICAgICAgICAgICAgICAgICAgICAgICByZXModHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgIHJlcS5vbmVycm9yID0gKCk9PntcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlcyhmYWxzZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGNyZWF0ZVwiKTtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGUpO1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogY3JlYXRlcyBpZiBubyBwcmVzZW50LCBlbHNlIHVwZGF0ZXMgdGhlIGV4aXN0aW5nIGRvY1xuICAgICAqIEBwYXJhbSBkYm5hbWUgXG4gICAgICogQHBhcmFtIGtleSBcbiAgICAgKiBAcGFyYW0gZG9jIFxuICAgICAqL1xuICAgIGFzeW5jIHVwZGF0ZUl0ZW1XaXRoS2V5KGRibmFtZTogc3RyaW5nLCBrZXk6IHN0cmluZywgZG9jOiBhbnkpIHtcbiAgICAgICAgLy9jaGVjayBpZiBpdCBleGlzdFxuICAgICAgICBjb25zdCBvYmplY3RTdG9yZSA9IHRoaXMuZGIudHJhbnNhY3Rpb24oW2RibmFtZV0sICdyZWFkd3JpdGUnKS5vYmplY3RTdG9yZShkYm5hbWUpO1xuXG4gICAgICAgIGlmIChvYmplY3RTdG9yZSkge1xuICAgICAgICAgICAgY29uc3QgZG9LZXlFeGlzdCA9IGF3YWl0IChuZXcgUHJvbWlzZTxib29sZWFuPigocmVzLCByZWopID0+IHtcbiAgICAgICAgICAgICAgICBvYmplY3RTdG9yZS5nZXRLZXkoa2V5KS5vbnN1Y2Nlc3MgPSAoZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAvL0B0cy1pZ25vcmVcbiAgICAgICAgICAgICAgICAgICAgbGV0IGtleSA9IG9iamVjdFN0b3JlLnJlc3VsdDtcbiAgICAgICAgICAgICAgICAgICAga2V5ID8gcmVzKHRydWUpIDogcmVzKGZhbHNlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICAvL2lmIGRvIGtleSBleGlzdFxuICAgICAgICAgICAgaWYgKGRvS2V5RXhpc3QpIHtcbiAgICAgICAgICAgICAgICAvL3dlIHdpbGwgbmVlZCB0byB1cGRhdGUgdGhlIGV4aXN0aW5nIGRvY1xuICAgICAgICAgICAgICAgIHJldHVybiBhd2FpdCAobmV3IFByb21pc2U8Ym9vbGVhbj4oKHJlcywgcmVqKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlcSA9IG9iamVjdFN0b3JlLnB1dChkb2MsIGtleSk7XG5cbiAgICAgICAgICAgICAgICAgICAgcmVxLm9uc3VjY2VzcyA9IChlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXModHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICByZXEub25lcnJvciA9IChlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGBGYWlsZWQgdG8gc2F2ZSBhdHRhY2htZW50ICR7dGhpcy5kYXRhYmFzZU5hbWV9LyR7a2V5fWApO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlcyhmYWxzZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiBhd2FpdCAobmV3IFByb21pc2U8Ym9vbGVhbj4oKHJlcywgcmVqKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlcSA9IG9iamVjdFN0b3JlLmFkZChkb2MsIGtleSk7XG4gICAgICAgICAgICAgICAgICAgIHJlcS5vbnN1Y2Nlc3MgPSAoZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzKHRydWUpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgcmVxLm9uZXJyb3IgPSAoZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihgRmFpbGVkIHRvIHNhdmUgYXR0YWNobWVudCAke3RoaXMuZGF0YWJhc2VOYW1lfS8ke2tleX1gKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXMoZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJObyBzdWNoIERCOiBcIiwgZGJuYW1lKTtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGFzeW5jIHJlYWQoZGJuYW1lOiBzdHJpbmcsIGluZGV4VmFsdWU/OiBhbnkpIHtcbiAgICAgICAgaWYgKGF3YWl0IHRoaXMuaXNJbml0aWFsaXplZCkge1xuICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuX3JlYWQoZGJuYW1lLCBpbmRleFZhbHVlKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIERvIG5vdCBjaGVjayBpcyBpbml0aWFsaXplZCwgdXNlZCBkdXJpbmcgb251cGdyYWRlIG5lZWRlZCBieSB0aGUgZGVyaXZhdGl2ZSBjbGFzc2VzLlxuICAgICAqIEBwYXJhbSBkYm5hbWUgXG4gICAgICogQHBhcmFtIGluZGV4VmFsdWUgXG4gICAgICovXG4gICAgcHJpdmF0ZSBhc3luYyBfcmVhZChkYm5hbWU6IHN0cmluZywgaW5kZXhWYWx1ZT86IGFueSkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgdHJhbnNhY3Rpb24gPSB0aGlzLmRiLnRyYW5zYWN0aW9uKFtkYm5hbWVdKTtcbiAgICAgICAgICAgIGNvbnN0IG9iamVjdFN0b3JlID0gdHJhbnNhY3Rpb24ub2JqZWN0U3RvcmUoZGJuYW1lKTtcbiAgICAgICAgICAgIGlmIChpbmRleFZhbHVlKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcmVxID0gb2JqZWN0U3RvcmUuZ2V0KGluZGV4VmFsdWUpO1xuICAgICAgICAgICAgICAgIHJldHVybiBhd2FpdCBuZXcgUHJvbWlzZTxhbnk+KChyZXMpPT57XG4gICAgICAgICAgICAgICAgICAgIHJlcS5vbnN1Y2Nlc3M9KGU6RXZlbnQpPT57XG4gICAgICAgICAgICAgICAgICAgICAgICAvL0B0cy1pZ25vcmVcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlcyhlLnRhcmdldC5yZXN1bHQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJlcS5vbmVycm9yPShlKT0+e1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzKHVuZGVmaW5lZCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGF3YWl0IG5ldyBQcm9taXNlPGFueT4oKHJlcyk9PntcbiAgICAgICAgICAgICAgICAgICAgbGV0IHQgPW9iamVjdFN0b3JlLmdldEFsbCgpO1xuICAgICAgICAgICAgICAgICAgICB0Lm9uc3VjY2Vzcz0oZTpFdmVudCk9PntcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vQHRzLWlnbm9yZVxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzKGUudGFyZ2V0LnJlc3VsdCk7XG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgIHQub25lcnJvcj0oZTpFdmVudCk9PntcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlcyh1bmRlZmluZWQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGFzeW5jIF91cGRhdGUoZGJuYW1lOiBzdHJpbmcsIG5ld1VwZGF0ZWRPYmplY3Q6IGFueSkge1xuICAgICAgICBpZiAoYXdhaXQgdGhpcy5pc0luaXRpYWxpemVkKSB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHJlcSA9IHRoaXMuZGIudHJhbnNhY3Rpb24oW2RibmFtZV0sICdyZWFkd3JpdGUnKVxuICAgICAgICAgICAgICAgICAgICAub2JqZWN0U3RvcmUoZGJuYW1lKVxuICAgICAgICAgICAgICAgICAgICAucHV0KG5ld1VwZGF0ZWRPYmplY3QpO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGF3YWl0IG5ldyBQcm9taXNlPGJvb2xlYW4+KHJlcz0+e1xuICAgICAgICAgICAgICAgICAgICByZXEub25zdWNjZXNzPShlOkV2ZW50KT0+e1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzKHRydWUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJlcS5vbmVycm9yPShlOkV2ZW50KT0+e1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzKGZhbHNlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gdXBkYXRlXCIpO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cblxuICAgIGFzeW5jIHVwZGF0ZShkYm5hbWU6IHN0cmluZywgcHJpbWFyeUtleTogc3RyaW5nLCB1cGRhdGVPYmplY3RGdW5jdGlvbjogVXBkYXRlT2JqZWN0RnVuY3Rpb24sIGRvY1RvQ3JlYXRlPzphbnkpIHtcbiAgICAgICAgY29uc3QgZG9jID0gYXdhaXQgdGhpcy5yZWFkKGRibmFtZSwgcHJpbWFyeUtleSk7XG4gICAgICAgIGlmICghZG9jKSB7XG4gICAgICAgICAgICBpZihkb2NUb0NyZWF0ZSl7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuY3JlYXRlKGRibmFtZSxkb2NUb0NyZWF0ZSk7XG4gICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IG5ld1VwZGF0ZWRPYmplY3QgPSBhd2FpdCB1cGRhdGVPYmplY3RGdW5jdGlvbihkb2MpO1xuICAgICAgICAgICAgaWYgKCFuZXdVcGRhdGVkT2JqZWN0KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy5fdXBkYXRlKGRibmFtZSwgbmV3VXBkYXRlZE9iamVjdCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cblxuICAgIGFzeW5jIGRlbGV0ZShkYm5hbWU6IHN0cmluZywgaW5kZXhWYWx1ZTogYW55KSB7XG4gICAgICAgIGlmIChhd2FpdCB0aGlzLmlzSW5pdGlhbGl6ZWQpIHtcbiAgICAgICAgICAgIGNvbnN0IHJlcSA9IHRoaXMuZGIudHJhbnNhY3Rpb24oW2RibmFtZV0sICdyZWFkd3JpdGUnKVxuICAgICAgICAgICAgICAgIC5vYmplY3RTdG9yZShkYm5hbWUpXG4gICAgICAgICAgICAgICAgLmRlbGV0ZShpbmRleFZhbHVlKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgcmV0dXJuIGF3YWl0IG5ldyBQcm9taXNlPGJvb2xlYW4+KHJlcz0+e1xuICAgICAgICAgICAgICAgIHJlcS5vbnN1Y2Nlc3M9KGU6RXZlbnQpPT57XG4gICAgICAgICAgICAgICAgICAgIHJlcyh0cnVlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmVxLm9uZXJyb3I9KGU6RXZlbnQpPT57XG4gICAgICAgICAgICAgICAgICAgIHJlcyhmYWxzZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBhc3luYyBmaW5kPFQ+KGRibmFtZTpzdHJpbmcsaW5kZXhfbmFtZTpzdHJpbmcsdmFsdWU6YW55KXtcbiAgICAgICAgY29uc3QgcmVzdWx0OlRbXT1bXTtcbiAgICAgICAgaWYoYXdhaXQgdGhpcy5pc0luaXRpYWxpemVkKXtcbiAgICAgICAgICAgIGNvbnN0IG9zPSB0aGlzLmRiLnRyYW5zYWN0aW9uKFtkYm5hbWVdLCdyZWFkb25seScpLm9iamVjdFN0b3JlKGRibmFtZSk7XG4gICAgICAgICAgICBjb25zdCBpbmRleCA9IG9zLmluZGV4KGluZGV4X25hbWUpO1xuICAgICAgICAgICAgaWYoaW5kZXgpe1xuICAgICAgICAgICAgICAgIGNvbnN0IHJhbmdlID0gSURCS2V5UmFuZ2Uub25seSh2YWx1ZSk7XG4gICAgICAgICAgICAgICAgYXdhaXQgbmV3IFByb21pc2U8dm9pZD4ocmVzPT57XG4gICAgICAgICAgICAgICAgICAgIGluZGV4Lm9wZW5DdXJzb3IocmFuZ2UpLm9uc3VjY2Vzcz0oZSk9PntcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vQHRzLWlnbm9yZVxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY3Vyc29yOiBJREJDdXJzb3IgPSBlLnRhcmdldC5yZXN1bHQ7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZihjdXJzb3Ipe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vQHRzLWlnbm9yZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKGN1cnNvci52YWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY3Vyc29yLmNvbnRpbnVlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXMoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuXG5cbn1cblxuLyp1c2FnZVxuICAgICAgICAgY29uc3QgZGFvID0gbmV3IERBTygnbXlhcHAnLCcxLjAnLFt7bmFtZTogJ3Rlc3QxJywgcHJpbWFyeUtleU5hbWU6ICduYW1lJ31dKTtcbiAgICAgICAgKGFzeW5jICgpPT57XG4gICAgICAgICAgIHRyeXtcbiAgICAgICAgICAgIGlmKGF3YWl0IGRhby5pc0luaXRpYWxpemVkKXtcbiAgICAgICAgICAgICAgICBjb25zdCB0MD0gYXdhaXQgZGFvLmNyZWF0ZSgndGVzdDEnLCB7bmFtZTogJ0FudXJhZyBWb2hyYScsIGFnZTogMzB9KTtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyh0MCk7XG4gICAgICAgICAgICAgICAgY29uc3QgdDE1ID0gYXdhaXQgZGFvLnVwZGF0ZSgndGVzdDEnLHtuYW1lOiAnQW51cmFnIFZvaHJhJywgYWdlOiAzMX0pXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2codDE1KTtcbiAgICAgICAgICAgICAgICBjb25zdCB0ID0gYXdhaXQgZGFvLnJlYWQoJ3Rlc3QxJywgJ0FudXJhZyBWb2hyYScpO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHQpO1xuICAgICAgICAgICAgICAgIGNvbnN0IHQwMSA9IGF3YWl0IGRhby5yZWFkKCd0ZXN0MScpO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHQwMSk7XG4gICAgICAgICAgICAgICAgY29uc3QgdDEgPSAgYXdhaXQgZGFvLmRlbGV0ZSgndGVzdDEnLCdBbnVyYWcgVm9ocmEnKTtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyh0MSk7XG4gICAgICAgICAgICAgICAgY29uc3QgdDIgPSBhd2FpdCBkYW8ucmVhZCgndGVzdDEnLCAnQWRmJyk7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2codDIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICB9Y2F0Y2goZSl7XG4gICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlKTtcbiAgICAgICAgICAgfVxuICAgICAgICB9KSgpO1xuKi9cbiJdLCJzb3VyY2VSb290IjoiIn0=